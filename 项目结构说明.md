# ago.im 项目结构说明

## 项目概览

本文档描述了ago.im项目的完整目录结构和文件组织方式，帮助开发团队快速理解项目架构。

## 根目录结构

```
afans/
├── README.md                    # 项目概览和说明
├── 商业计划书.md                # 商业计划书（BP）
├── MRD-市场需求文档.md          # 市场需求文档
├── PRD-产品需求文档.md          # 产品需求文档
├── 项目结构说明.md              # 本文档
├── docs/                        # 项目文档目录
│   ├── api/                     # API文档
│   ├── design/                  # 设计文档
│   ├── deployment/              # 部署文档
│   └── development/             # 开发文档
├── frontend/                    # 前端项目
│   ├── web/                     # Web端应用
│   ├── mobile/                  # 移动端应用
│   └── admin/                   # 管理后台
├── backend/                     # 后端项目
│   ├── api-gateway/             # API网关
│   ├── user-service/            # 用户服务
│   ├── content-service/         # 内容服务
│   ├── payment-service/         # 支付服务
│   ├── notification-service/    # 通知服务
│   └── analytics-service/       # 数据分析服务
├── database/                    # 数据库相关
│   ├── migrations/              # 数据库迁移文件
│   ├── seeds/                   # 初始数据
│   └── schemas/                 # 数据库结构
├── infrastructure/              # 基础设施
│   ├── docker/                  # Docker配置
│   ├── kubernetes/              # K8s配置
│   ├── terraform/               # 基础设施代码
│   └── monitoring/              # 监控配置
├── scripts/                     # 脚本文件
│   ├── build/                   # 构建脚本
│   ├── deploy/                  # 部署脚本
│   └── utils/                   # 工具脚本
├── tests/                       # 测试文件
│   ├── unit/                    # 单元测试
│   ├── integration/             # 集成测试
│   └── e2e/                     # 端到端测试
└── tools/                       # 开发工具
    ├── linting/                 # 代码检查配置
    ├── formatting/              # 代码格式化
    └── generators/              # 代码生成器
```

## 详细目录说明

### 📁 docs/ - 项目文档

```
docs/
├── api/
│   ├── user-api.md             # 用户API文档
│   ├── content-api.md          # 内容API文档
│   ├── payment-api.md          # 支付API文档
│   └── openapi.yaml            # OpenAPI规范
├── design/
│   ├── ui-design.md            # UI设计规范
│   ├── ux-guidelines.md        # UX设计指南
│   ├── brand-guidelines.md     # 品牌设计指南
│   └── assets/                 # 设计资源
│       ├── logos/              # Logo文件
│       ├── icons/              # 图标文件
│       └── mockups/            # 设计稿
├── deployment/
│   ├── production.md           # 生产环境部署
│   ├── staging.md              # 测试环境部署
│   ├── development.md          # 开发环境搭建
│   └── troubleshooting.md      # 故障排除指南
└── development/
    ├── coding-standards.md     # 编码规范
    ├── git-workflow.md         # Git工作流
    ├── testing-guidelines.md   # 测试指南
    └── security-guidelines.md  # 安全开发指南
```

### 🌐 frontend/ - 前端项目

```
frontend/
├── web/                        # Web端应用
│   ├── public/                 # 静态资源
│   ├── src/
│   │   ├── components/         # 通用组件
│   │   ├── pages/              # 页面组件
│   │   ├── hooks/              # 自定义Hooks
│   │   ├── services/           # API服务
│   │   ├── store/              # 状态管理
│   │   ├── utils/              # 工具函数
│   │   ├── styles/             # 样式文件
│   │   └── types/              # TypeScript类型
│   ├── package.json
│   ├── tsconfig.json
│   └── vite.config.ts
├── mobile/                     # 移动端应用
│   ├── src/
│   │   ├── components/         # 移动端组件
│   │   ├── screens/            # 页面屏幕
│   │   ├── navigation/         # 导航配置
│   │   ├── services/           # API服务
│   │   ├── store/              # 状态管理
│   │   └── utils/              # 工具函数
│   ├── package.json
│   └── metro.config.js
└── admin/                      # 管理后台
    ├── src/
    │   ├── components/         # 后台组件
    │   ├── views/              # 页面视图
    │   ├── router/             # 路由配置
    │   ├── store/              # 状态管理
    │   ├── api/                # API接口
    │   └── utils/              # 工具函数
    ├── package.json
    └── vue.config.js
```

### ⚙️ backend/ - 后端项目

```
backend/
├── api-gateway/                # API网关
│   ├── src/
│   │   ├── middleware/         # 中间件
│   │   ├── routes/             # 路由配置
│   │   ├── auth/               # 认证授权
│   │   └── config/             # 配置文件
│   ├── package.json
│   └── Dockerfile
├── user-service/               # 用户服务
│   ├── src/
│   │   ├── controllers/        # 控制器
│   │   ├── services/           # 业务逻辑
│   │   ├── models/             # 数据模型
│   │   ├── repositories/       # 数据访问
│   │   ├── validators/         # 数据验证
│   │   └── utils/              # 工具函数
│   ├── tests/                  # 测试文件
│   ├── package.json
│   └── Dockerfile
├── content-service/            # 内容服务
│   ├── src/
│   │   ├── controllers/        # 内容控制器
│   │   ├── services/           # 内容业务逻辑
│   │   ├── models/             # 内容模型
│   │   ├── processors/         # 视频处理
│   │   ├── recommender/        # 推荐算法
│   │   └── storage/            # 存储管理
│   ├── package.json
│   └── Dockerfile
├── payment-service/            # 支付服务
│   ├── src/
│   │   ├── controllers/        # 支付控制器
│   │   ├── services/           # 支付业务逻辑
│   │   ├── models/             # 支付模型
│   │   ├── gateways/           # 支付网关
│   │   ├── webhooks/           # 支付回调
│   │   └── security/           # 支付安全
│   ├── package.json
│   └── Dockerfile
├── notification-service/       # 通知服务
│   ├── src/
│   │   ├── controllers/        # 通知控制器
│   │   ├── services/           # 通知业务逻辑
│   │   ├── models/             # 通知模型
│   │   ├── channels/           # 通知渠道
│   │   ├── templates/          # 消息模板
│   │   └── queue/              # 消息队列
│   ├── package.json
│   └── Dockerfile
└── analytics-service/          # 数据分析服务
    ├── src/
    │   ├── controllers/        # 分析控制器
    │   ├── services/           # 分析业务逻辑
    │   ├── models/             # 分析模型
    │   ├── collectors/         # 数据收集
    │   ├── processors/         # 数据处理
    │   └── reports/            # 报表生成
    ├── package.json
    └── Dockerfile
```

### 🗄️ database/ - 数据库相关

```
database/
├── migrations/                 # 数据库迁移
│   ├── 001_create_users.sql
│   ├── 002_create_creators.sql
│   ├── 003_create_videos.sql
│   ├── 004_create_subscriptions.sql
│   └── 005_create_payments.sql
├── seeds/                      # 初始数据
│   ├── users.sql
│   ├── categories.sql
│   └── test_data.sql
└── schemas/                    # 数据库结构
    ├── user_schema.sql
    ├── content_schema.sql
    ├── payment_schema.sql
    └── analytics_schema.sql
```

### 🏗️ infrastructure/ - 基础设施

```
infrastructure/
├── docker/                     # Docker配置
│   ├── docker-compose.yml     # 本地开发环境
│   ├── docker-compose.prod.yml # 生产环境
│   └── dockerfiles/            # 各服务Dockerfile
├── kubernetes/                 # K8s配置
│   ├── namespaces/             # 命名空间
│   ├── deployments/            # 部署配置
│   ├── services/               # 服务配置
│   ├── ingress/                # 入口配置
│   └── configmaps/             # 配置映射
├── terraform/                  # 基础设施代码
│   ├── modules/                # Terraform模块
│   ├── environments/           # 环境配置
│   │   ├── dev/
│   │   ├── staging/
│   │   └── production/
│   └── variables.tf
└── monitoring/                 # 监控配置
    ├── prometheus/             # Prometheus配置
    ├── grafana/                # Grafana配置
    ├── alertmanager/           # 告警配置
    └── logs/                   # 日志配置
```

### 🧪 tests/ - 测试文件

```
tests/
├── unit/                       # 单元测试
│   ├── backend/
│   │   ├── user-service/
│   │   ├── content-service/
│   │   └── payment-service/
│   └── frontend/
│       ├── web/
│       ├── mobile/
│       └── admin/
├── integration/                # 集成测试
│   ├── api/
│   ├── database/
│   └── services/
└── e2e/                        # 端到端测试
    ├── user-flows/
    ├── payment-flows/
    └── content-flows/
```

## 开发环境配置

### 环境要求

- **Node.js**: >= 18.0.0
- **Python**: >= 3.11.0
- **Docker**: >= 24.0.0
- **Kubernetes**: >= 1.27.0
- **MySQL**: >= 8.0.0
- **Redis**: >= 7.0.0
- **TypeScript**: >= 5.0.0

### 快速开始

1. **克隆项目**
   ```bash
   git clone https://github.com/your-org/afans.git
   cd afans
   ```

2. **安装依赖**
   ```bash
   # 安装前端依赖
   cd frontend/web && npm install
   cd ../mobile && npm install
   cd ../admin && npm install
   
   # 安装后端依赖
   cd ../../backend/user-service && npm install
   cd ../content-service && npm install
   cd ../payment-service && npm install
   ```

3. **启动开发环境**
   ```bash
   # 启动基础服务（数据库、Redis等）
   docker-compose -f infrastructure/docker/docker-compose.yml up -d
   
   # 启动后端服务
   npm run dev:backend
   
   # 启动前端应用
   npm run dev:frontend
   ```

### 代码规范

- **JavaScript/TypeScript**: ESLint + Prettier
- **Python**: Black + Flake8
- **Git提交**: Conventional Commits
- **分支策略**: Git Flow

### 部署流程

#### 开发环境
```bash
# 启动开发环境
docker-compose -f infrastructure/docker/docker-compose.yml up -d

# 数据库迁移
npm run migrate

# 启动前端开发服务器
npm run dev:frontend
```

#### 生产环境（海外部署）
```bash
# 构建镜像
docker build -t afans-api .

# 部署到荷兰 Kubernetes集群
   kubectl apply -f infrastructure/kubernetes/

   # 配置国际域名和SSL
   kubectl apply -f infrastructure/kubernetes/ingress/

   # 配置CloudFlare CDN
   # 设置多地区负载均衡
   # 配置成人内容地理限制（基于荷兰法律）
```

## 文件命名规范

### 前端文件命名
- **组件**: PascalCase (UserProfile.tsx)
- **页面**: PascalCase (HomePage.tsx)
- **工具函数**: camelCase (formatDate.ts)
- **样式文件**: kebab-case (user-profile.scss)

### 后端文件命名
- **控制器**: PascalCase (UserController.ts)
- **服务**: PascalCase (UserService.ts)
- **模型**: PascalCase (User.ts)
- **工具函数**: camelCase (hashPassword.ts)

### 数据库命名
- **表名**: snake_case (user_profiles)
- **字段名**: snake_case (created_at)
- **索引名**: idx_table_column

## 版本控制

### 分支策略
- **main**: 生产环境代码
- **develop**: 开发环境代码
- **feature/***: 功能开发分支
- **hotfix/***: 紧急修复分支
- **release/***: 发布准备分支

### 提交规范
```
type(scope): description

[optional body]

[optional footer]
```

类型说明：
- **feat**: 新功能
- **fix**: 修复bug
- **docs**: 文档更新
- **style**: 代码格式调整
- **refactor**: 代码重构
- **test**: 测试相关
- **chore**: 构建过程或辅助工具的变动

## 监控和日志

### 监控指标
- **系统指标**: CPU、内存、磁盘、网络
- **应用指标**: 响应时间、错误率、吞吐量
- **业务指标**: 用户活跃度、收入、转化率

### 日志规范
- **日志级别**: ERROR > WARN > INFO > DEBUG
- **日志格式**: 结构化JSON格式
- **日志存储**: ELK Stack (Elasticsearch + Logstash + Kibana)

## 安全考虑

### 安全考虑

#### 代码安全
- 敏感信息使用环境变量
- API密钥加密存储
- 定期安全扫描
- 依赖包漏洞检查

#### 运行时安全
- HTTPS强制加密
- 数据库访问控制
- 防火墙配置
- 日志审计
- GDPR/CCPA合规
- 跨境数据传输加密
- 国际支付安全认证

#### 成人内容合规
- 年龄验证系统（18+实名认证）
- 内容分级和标签系统
- 地理位置访问限制
- 成人内容免责声明
- 荷兰司法管辖区合规：遵循荷兰成人内容相关法规
- 新加坡法律风险规避：新加坡对成人内容有严格限制，持有、分发可面临最高2年监禁和8万新币罚款，因此不在新加坡部署

---

## 更新记录

- **v1.0.0** (2024-01-01): 初始项目结构
- 后续更新请查看Git提交记录

---

*本文档会随着项目发展持续更新*